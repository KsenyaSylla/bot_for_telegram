# Телеграм-бот для включения/отключения дефектов, а также получения статуса и истории

## Запускаем контейнеры

docker-compose up -d

## Основные команды

- **/on** - включить дефект
- **/off** - отключить дефект
- **/status** - получение нынешнего статуса дефекта: включен или отключен
- **/history** - получение истории включений/отключений дефектов
- **/defect_info** - получение информации о дефекте по коду или названию
- **/check_updates** - проверка обновлений названий и кодов дефекта
- **/update_dict** - обновление рабочего словаря

## Словари с кодами и названиями

Словарь с кодами и названиями дефектов, используемый в боте на постоянной основе лежит в папке utils, defects_dict.py.
Для проверки актуальности названий и кодов есть скрипты в папке dict_of_defects. Обновленные данные для сравнения скрипт берет из google.sheets. Креды пока хранятся не очень хорошо. Надо как-то прятать, но пока мне не понятно как именно.

## Структура БД

код дефекта - defect(INT), статус дефекта - status(TEXT), история изменеия статусов - history(JSONB)

## Проверяем, что файл CSV есть в контейнере

docker exec -it postgres_db ls -l /docker-entrypoint-initdb.d/

## Подключаемся к базе

docker exec -it postgres_db psql -U bot_user -d defects

## Импортируем CSV в таблицу

\COPY defects FROM '/docker-entrypoint-initdb.d/data.csv' DELIMITER ',' CSV HEADER;

## Проверяем, что данные добавились

SELECT * FROM defects;

## Если БД была создана с ошибкой

надо чистить volumes
sudo docker volume ls
sudo docker volume rm <имя volume>
